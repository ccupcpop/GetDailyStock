name: 測試百度網盤上傳

on:
  # 只允許手動觸發
  workflow_dispatch:

jobs:
  test-baidu-upload:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      - name: Check files to upload
        run: |
          echo "====== 檢查要上傳的檔案 ======"
          echo ""
          echo "Excel 報表:"
          ls -lh *.xlsx 2>/dev/null || echo "  (無)"
          echo ""
          echo "HTML 圖表:"
          find StockHTML StockOTCHTML -name "*.html" 2>/dev/null | head -5 || echo "  (無)"
          echo ""
          echo "PNG 圖表:"
          find StockPNG StockOTCPNG -name "*.png" 2>/dev/null | head -5 || echo "  (無)"
          echo ""
          echo "================================"
      
      - name: Test Baidu Netdisk Upload
        env:
          BAIDU_APP_KEY: ${{ secrets.BAIDU_APP_KEY }}
          BAIDU_SECRET_KEY: ${{ secrets.BAIDU_SECRET_KEY }}
          BAIDU_REFRESH_TOKEN: ${{ secrets.BAIDU_REFRESH_TOKEN }}
        run: |
          echo "開始測試百度網盤上傳..."
          echo ""
          python baidu_uploader.py
      
      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: baidu-upload-test-log
          path: |
            *.log
          retention-days: 7